<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jörg Kantel">

<title>Der Schockwellenreiter - Devlog: Smashing Pumpkins mit Twine und SugarCube (Teil 3)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script>
<script data-goatcounter="https://kantel.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Der Schockwellenreiter</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Suchen"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Navigation umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Über den Schockwellenreiter</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kantel/kantel.github.io" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://mastodon.social/@kantel" rel="" target=""><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Devlog: Smashing Pumpkins mit Twine und SugarCube (Teil 3)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Twine</div>
    <div class="quarto-category">Interactive Fiction</div>
    <div class="quarto-category">SugarCube</div>
    <div class="quarto-category">Spieleprogrammierung</div>
    <div class="quarto-category">Bilder</div>
    <div class="quarto-category">Stable Diffusion</div>
    <div class="quarto-category">Künstliche Intelligenz</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor:in</div>
    <div class="quarto-title-meta-contents">
             <p>Jörg Kantel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Veröffentlichungsdatum</div>
    <div class="quarto-title-meta-contents">
      <p class="date">19. November 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.flickr.com/photos/schockwellenreiter/53320680408/"><img src="images/smashingpumpkinscover-b.jpg" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><a href="https://kantel.github.io/posts/2023111801_smashing_pumpkins_v03/">Wie ich gestern schon schrieb</a>, ist die aktuelle <em>Version 0.3 alpha</em> meines kleinen <a href="http://cognitiones.kantel-chaos-team.de/multimedia/spieleprogrammierung/twine2.html">Twine</a>-<a href="https://kantel.github.io/posts/2023103102_halloween_twine/">Spiels</a> über eine kleine Hexe, der ich den Namen »Emmy« gegeben habe, die einen <a href="https://kantel.github.io/posts/2023102101_smashed_pumpkins/">wahnsinningen, Kürbisse vernichtenden Priester</a> auf einem Friedhof stoppen muß, nicht nur die erste spielbare Fassung, sondern auch die erste, in der ich im großen Stil <a href="https://www.motoslave.net/sugarcube/2/docs/">SugarCube</a>-Makros einsetzte. Daher ist es an der Zeit für ein <a href="https://kantel.github.io/posts/2023110901_smashing_pumpkins_devlog_1/">weiteres</a> <a href="https://kantel.github.io/posts/2023111301_smashing_pumpkins_devlog_2/">Devlog</a>:</p>
<p>Wenn man Makros nutzt, ist es in der Regel sinnvoll, die darin verwendeten Variablen beim Start des Spiels mit Werten vorzubelegen. Dafür gibt es in SugarCube eine spezielle Passage <code>StoryInit</code> die beim Start und Neustart eines jeden Spiels im Hintergrund als erstes aufgerufen wird. In der derzeitigen Fassung des Spiels sieht sie so aus:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href="#cb1-1"></a>:: StoryInit [green] {"position":"50,75","size":"100,100"}</span>
<span id="cb1-2"><a href="#cb1-2"></a>&lt;&lt;set $start to false&gt;&gt;</span>
<span id="cb1-3"><a href="#cb1-3"></a>&lt;&lt;set $gateOpen to false&gt;&gt;</span>
<span id="cb1-4"><a href="#cb1-4"></a>&lt;&lt;set $hasPickaxe to false&gt;&gt;</span>
<span id="cb1-5"><a href="#cb1-5"></a>&lt;&lt;set $hasPotion to false&gt;&gt;</span>
<span id="cb1-6"><a href="#cb1-6"></a>&lt;&lt;set $hasBroomstick to false&gt;&gt;</span>
<span id="cb1-7"><a href="#cb1-7"></a>&lt;&lt;set $hasAttacked to false&gt;&gt;</span>
<span id="cb1-8"><a href="#cb1-8"></a>&lt;&lt;set $hasKey to false&gt;&gt;</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Der (optionale) Tag <code>green</code> ist mit der Farbe grün verbunden und soll signalisieren, daß es sich um eine Spezialpassage handelt. Und für diese Passagen ist es besonders wichtig, darauf zu achten, daß Groß- und Kleinschreibung zählt. Nur <code>StoryInit</code> wird als Spezialpassage erkannt, nicht jedoch <code>Storyinit</code>, <code>storyinit</code>, <code>storyInit</code> oder jede andere Form der Mischung von großen und kleinen Buchstaben.</p>
<p>In dieser (Spezial-) Passage erkennt man schon folgendes:</p>
<ul>
<li>Makros werden in SugarCube zwischen zwei spitze Klammerpaare (<code>&lt;&lt;…&gt;&gt;</code>) geschrieben.</li>
<li>Variablennamen beginnen in SugarCube immer mit dem Dollarzeichen <code>$</code>.</li>
</ul>
<p>Auch wenn dieses Spiel bisher mit dem Variablentyp <code>boolean</code> auskommt, SugarCube kennt noch zwei weitere Variablentypen, nämlich <code>arithmetic</code> und <code>string</code>. Das sieht im Passage-Markup wie folgt aus:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href="#cb2-1"></a>&lt;&lt;set $myBoolean to true&gt;&gt;        /* Boolean */</span>
<span id="cb2-2"><a href="#cb2-2"></a>&lt;&lt;set $myNumber to 3.14&gt;&gt;         /* Arithmetic */</span>
<span id="cb2-3"><a href="#cb2-3"></a>&lt;&lt;set $myName to "Jörg"&gt;&gt;         /* String */</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Variablen vom Typ <code>boolean</code> können nur die Werte <code>true</code> oder <code>false</code> enthalten (auch hier die Kleinschreibung beachten, <code>True</code> oder <code>False</code> (wie in Python) geht gar nicht), Variblen vom Typ <code>arithmetic</code> können sowohl aus Fließkommazahlen (<code>&lt;&lt;set $pi to 3.14&gt;&gt;</code>) wie auch aus Integerwerten (<code>&lt;&lt;set $health to 10&gt;&gt;</code>) bestehen und für <code>string</code> gilt, daß alles was zwischen zwei Hochkommata (<code>"…"</code>) steht, als Text behandelt wird.</p>
<p>Wie das obige Codeschnipsel zeigt, beherrscht SugarCube auch Kommentare, und zwar in folgenden Schreibweisen:</p>
<ol type="1">
<li><em>C-Style</em>: <code>/* Dies ist ein Kommentar. */</code></li>
<li><em>TiddlyWiki Style</em>: <code>/% Dies ist ebenfalls ein Kommentar. %/</code></li>
<li><em>HTML Style</em>: <code>&lt;!-- Und auch dies ist ein Kommentar. --&gt;</code></li>
</ol>
<p>Kommentare vom ersten Typ können sowohl im Passage Markup, wie auch in JavaScript- und CSS-Quellcode verwendet werden, während die beiden anderen nur im Passage-Markup gültige Kommentare sind. Daher empfehle ich, aus Gründen der Vereinheitlichung nur Kommentare vom Typ 1 <em>(C-Style)</em> zu verwenden. Sie sind einer Programmiererin oder einem Programierer auch am Geläufigsten.</p>
<p>Variablen machen natürlich nur Sinn, wenn sie auch verändert werden können. Im einfachsten Fall erledigt auch dieses das <code>&lt;&lt;set …&gt;&gt;</code>-Makro, wie zum Beispiel in der Passage <code>Vorraum</code>, in der das Friedhofstor geöffnet wird:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1"><a href="#cb3-1"></a>:: Vorraum {"position":"950,500","size":"100,100"}</span>
<span id="cb3-2"><a href="#cb3-2"></a>[img[images/button1.jpg]]</span>
<span id="cb3-3"><a href="#cb3-3"></a>&lt;&lt;set $gateOpen to true&gt;&gt;\</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>An der Wand des Vorraums erkennt Emmy einen riesigen Schalter. Als sie diesen umlegt,</span>
<span id="cb3-6"><a href="#cb3-6"></a>leuchtet an der Wand ein rotes Licht auf und ein Display unter dem Schalter verkündet:</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>!!!Gate Open!</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a>Die kleine Hexe verläßt das Pförtnerhaus und schlägt hinter sich die Tür mit einem</span>
<span id="cb3-11"><a href="#cb3-11"></a>lauten Knall zu. Erst dann bemerkt sie, daß sie den Schlüssel zum Haus auf einem</span>
<span id="cb3-12"><a href="#cb3-12"></a>Tisch im Raum vergessen hat.&lt;&lt;set $hasKey to false&gt;&gt;</span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a>Egal, Emmy macht sich auf dem Weg zum alten [[Friedhofstor-&gt;Tor]].</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In dieser Passage wird einmal mit <code>&lt;&lt;set $gateOpen to true&gt;&gt;</code> der Wert von <code>$gateOpen</code> verändert und zum zweiten der mit <code>&lt;&lt;set $hasKey to false&gt;&gt;</code> der Wert von <code>$hasKey</code>, der auf <code>true</code> gesetzt wurde, als die kleine Hexe den Priester besiegt und den Schlüssel an sich genommen hatte, wieder zurück auf <code>false</code> gesetzt, weil unsere Heldin den Schlüssel auf einem Tisch im Vorraum von liegen gelassen hatte. (Damit will ich verhindern, daß Emmy den Vorraum noch einmal betreten kann, wenn sie den Toröffnungsmechanismus schon einmal betätigt hatte.)</p>
<p>Twine hat außerdem die Eigenart, Zeilen, die nur Makros und keinen sichtbaren Text enthalten, als Leerzeilen anzuzeigen, ein Problem, das erst mit dem Storyformat <a href="https://klembot.github.io/chapbook/guide/">Chapbook</a> zufriedenstellend gelöst wurde. Bei den anderen Storyformaten muß gegen überflüssige Leerzeilen dagegen mit Tricks gekämpft werden: <a href="https://twine2.neocities.org/">Harlowe</a> zum Beispiel verwendet geschweifte Klammerpaare (<code>{…}</code>), um die Leerzeichen in Makros zu unterdrücken, während man in SugarCube dies am einfachsten durch einen Backslash (<code>\</code>) am Ende der jeweiligen Zeile erreicht.</p>
<p>Dabei sind immer wieder Tests nötig, denn Twine mit SugarCube oder Harlowe ist manchmal sehr eigenwillig, wann es eine Leerzeile setzen will und wann nicht. Zum Beispiel habe ich an der Passage <code>Gräberfeld2</code> sehr lange probiert, bis die Kombination von Ersetzung durch Makros und Leerzeichen zufriedenstellend angezeigt wurde:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb4-1"><a href="#cb4-1"></a>:: Gräberfeld2 {"position":"950,175","size":"100,100"}</span>
<span id="cb4-2"><a href="#cb4-2"></a>[img[images/graeberfeld2.jpg]]</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>Das Feld am Ende des Pfades wirkt noch älter. Es wird von uralten, verwitterten</span>
<span id="cb4-5"><a href="#cb4-5"></a>Bäumen umsäumt und nur noch wenige Gräber haben die Jahre überdauert.</span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a>&lt;&lt;if not $hasBroomstick&gt;&gt;&lt;&lt;linkappend "An einem der alten Bäume lehnt Emmys</span>
<span id="cb4-8"><a href="#cb4-8"></a>Hexenbesen, den sie schon die ganze Zeit vermißt hat. "&gt;&gt;Emmy nimmt den Besen an</span>
<span id="cb4-9"><a href="#cb4-9"></a>sich.&lt;&lt;set $hasBroomstick to true&gt;&gt;&lt;&lt;/linkappend&gt;&gt;</span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a>Es gibt von hier aus keinen weiteren Weg als den Pfad, den sie gekommen war,</span>
<span id="cb4-12"><a href="#cb4-12"></a>zurück zum [[Gräberfeld-&gt;Urnengräber]] mit der Statue.</span>
<span id="cb4-13"><a href="#cb4-13"></a>&lt;&lt;else&gt;&gt;\</span>
<span id="cb4-14"><a href="#cb4-14"></a>Es gibt von hier aus keinen weiteren Weg als den Pfad, den sie gekommen war,</span>
<span id="cb4-15"><a href="#cb4-15"></a>zurück zum [[Gräberfeld-&gt;Urnengräber]] mit der Statue.</span>
<span id="cb4-16"><a href="#cb4-16"></a>&lt;&lt;/if&gt;&gt;\</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Die Herausforderung war hier die Verschachtelung des <code>&lt;&lt;if … else&gt;&gt;</code>-Makros mit den Makros <code>&lt;&lt;linkappend …&gt;&gt;</code> und <code>&lt;&lt;set …&gt;&gt;</code>. <code>&lt;&lt;if …&gt;&gt;</code> prüft ab, ob eine Bedingung erfüllt ist (in diesem Falle, ob die Hexe (noch) <strong>keinen</strong> Hexenbesen besitzt (<code>not $hasBroomstick</code>)). Dann soll an dem im Makro eingeschlossenen Satz »<em>An einem der alten Bäume lehnt Emmys Hexenbesen, den sie schon die ganze Zeit vermißt hat.</em>« nicht nur der Satz »<em>Emmy nimmt den Besen an sich.</em>« angehängt werden, sondern Twine soll sich auch merken, daß die Hexe ab sofort einen Besen besitzt: <code>&lt;&lt;set $hasBroomstick to true&gt;&gt;</code>. Warum das die Bedingung einleitende <code>&lt;&lt;if&gt;&gt;</code> <strong>keinen</strong> Backslash benötigt, das <code>&lt;&lt;else&gt;&gt;</code> und das abschließende <code>&lt;&lt;/if&gt;&gt;</code> aber doch, darüber mußte ich lange nachdenken.</p>
<p>Ähnlich sieht die Passage <code>Urnengräber</code> aus, die zweite Passage, an der die kleine Hexe bisher ein <em>Item</em> aufnehmen kann:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb5-1"><a href="#cb5-1"></a>:: Urnengräber {"position":"800,175","size":"100,100"}</span>
<span id="cb5-2"><a href="#cb5-2"></a>[img[images/monument1.jpg]]</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>Dieses Feld scheint der älteste Teil des Friedhofs zu sein. Die Gräber sind völlig</span>
<span id="cb5-5"><a href="#cb5-5"></a>heruntergekommen und im Hintergrund erkennt man eine verfallene Kapelle</span>
<span id="cb5-6"><a href="#cb5-6"></a>&lt;&lt;if not $hasPickaxe&gt;&gt;, an deren Mauer eine</span>
<span id="cb5-7"><a href="#cb5-7"></a>&lt;&lt;linkappend "Spitzhacke lehnt. "&gt;&gt; Emmy nimmt die Hacke an sich und befestigt</span>
<span id="cb5-8"><a href="#cb5-8"></a>sie an ihrem Gürtel. Mit dieser Waffe fühlt sie sich nicht mehr so hilflos.</span>
<span id="cb5-9"><a href="#cb5-9"></a>&lt;&lt;set $hasPickaxe to true&gt;&gt;&lt;&lt;/linkappend&gt;&gt;&lt;&lt;/if&gt;&gt;</span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a>In der Mitte steht eine relativ gut erhaltene, lebensgroße Statue eines Menschen</span>
<span id="cb5-12"><a href="#cb5-12"></a>mit Fledermausflügeln. Hinter der Statue lädt ein [[versteckter Pfad-&gt;Gräberfeld2]]</span>
<span id="cb5-13"><a href="#cb5-13"></a>zu weiteren Erkundungen dieses alten Friedhofteiles ein.</span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a>Der Weg in den [[Süden-&gt;Tor]] führt zum alten Friedhofseingang mit seinem</span>
<span id="cb5-16"><a href="#cb5-16"></a>riesigen Tor, im [[Westen-&gt;Brunnen]] hört sie das Plätschern eines Brunnens.</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Da hier das das <code>&lt;&lt;linkappend …&gt;&gt;</code> einschließende <code>&lt;&lt;if …&gt;&gt;</code>-Makro jedoch keinen <code>&lt;&lt;else&gt;&gt;</code>-Zweig benötigte, konnten die Makros in den Passagentext eingeschlossen werden, und so gab es auch keine Probleme mit unerwünschten Leerzeilen. Auch hier wird mit <code>&lt;&lt;set $hasPickaxe to true&gt;&gt;</code> der Wert einer Variablen innerhalb des <code>&lt;&lt;if …&gt;&gt;</code>Makros verändert.</p>
<p>Eine besondere Herausforderung waren dann die Passagen, die den Kampf der Hexe mit dem Priester betrafen. Hier mußte in den umliegenden Passagen <code>Brunnen</code> und <code>Pfad</code> erst einmal abgeprüft werden, ob der Kampf schon stattgefunden hat, um dann die Hexe entweder auf die Passage <code>Gräberfeld</code> oder <code>Gräberfeld leer</code> zu lenken:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1"><a href="#cb6-1"></a>:: Gräberfeld {"position":"250,175","size":"100,100"}</span>
<span id="cb6-2"><a href="#cb6-2"></a>[img[images/priest2.jpg]]</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a>Emmy sieht auf einem weiten Gräberfeld den wahnsinnigen Priester mit einer großen</span>
<span id="cb6-5"><a href="#cb6-5"></a>Schaufel auf die Halloween-Kürbisse einschlagen. Er starrt sie mit seinem irren</span>
<span id="cb6-6"><a href="#cb6-6"></a>Gesichsausdruck und glasigen Augen böse an.</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a>&lt;&lt;if $hasPickaxe&gt;&gt;\</span>
<span id="cb6-9"><a href="#cb6-9"></a>Emmy geht davon unbeeindruckt [[auf den Priester zu-&gt;Attacke1]].</span>
<span id="cb6-10"><a href="#cb6-10"></a>&lt;&lt;else&gt;&gt;\</span>
<span id="cb6-11"><a href="#cb6-11"></a>Emmy sieht ein, daß sie unbewaffner nichts gegen ihn ausrichten kann. Was soll</span>
<span id="cb6-12"><a href="#cb6-12"></a>sie tun? Soll sie sich an dem Priester vorbei zum [[Brunnen-&gt;Attacke1]] im Osten</span>
<span id="cb6-13"><a href="#cb6-13"></a>durchschlagen oder soll sie über den [[Pfad]] im Süden fliehen?</span>
<span id="cb6-14"><a href="#cb6-14"></a>&lt;&lt;/if&gt;&gt;</span>
<span id="cb6-15"><a href="#cb6-15"></a></span>
<span id="cb6-16"><a href="#cb6-16"></a>:: Gräberfeld leer {"position":"450,175","size":"100,100"}</span>
<span id="cb6-17"><a href="#cb6-17"></a>[img[images/graeberfeldleer.jpg]]</span>
<span id="cb6-18"><a href="#cb6-18"></a></span>
<span id="cb6-19"><a href="#cb6-19"></a>Emmy steht wieder auf dem Gräberfeld, auf dem sie den Priester besiegt hat.</span>
<span id="cb6-20"><a href="#cb6-20"></a>Nun liegt es friedlich vor ihr. Im Süden sieht sie den schmalen, gewundenen</span>
<span id="cb6-21"><a href="#cb6-21"></a>[[Pfad]] und im Osten plätschert immer noch der [[Brunnen]] an der Friedhofsmauer,</span>
<span id="cb6-22"><a href="#cb6-22"></a>so als ob nichts gewesen wäre.</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Wenn der Kampf stattgefunden und die kleine Hexe den Priester besiegt hat (in der derzeitigen Fassung kann die Hexe (noch) nicht verlieren), wird sie auf die Passage <code>Gräberfeld leer</code> geleitet. Dies ist eine stinknormale Passage, in der nichts anderes passiert, als daß sie von hier aus die umliegenden Passagen erreichen kann.</p>
<p>In der eigentlichen Passage <code>Gräberfeld</code> findet jedoch, abhängig davon, ob Emmy mit einer Spitzhacke bewaffnet ist (<code>&lt;&lt;if $hasPickaxe&gt;&gt;</code>) die Vorbereitung zum Kampf statt (Passage <code>Attacke1</code>) oder sie entschließt sich zur Flucht. Falls sie diese in Richtung Brunnen unternimmt, wird sie ebenfalls über die Passage <code>Attacke1</code> geleitet. In dieser Passage gibt es daher noch eine weitere Verzweigung, je nachdem, ob die Hexe im Besitz der Spitzhacke ist oder nicht:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1"><a href="#cb7-1"></a>&lt;&lt;if $hasPickaxe&gt;&gt;\</span>
<span id="cb7-2"><a href="#cb7-2"></a>[img[images/angriff1.jpg]]</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a>Emmy ergreift die Spitzhacke mit ihren Fäusten und schlägt wütend und kräftig</span>
<span id="cb7-5"><a href="#cb7-5"></a>auf den Priester ein. Nach einer kurzen, aber heftigen Gegenwehr</span>
<span id="cb7-6"><a href="#cb7-6"></a>[[bricht er schwer verletzt zusammen-&gt;Key]].</span>
<span id="cb7-7"><a href="#cb7-7"></a>&lt;&lt;else&gt;&gt;\</span>
<span id="cb7-8"><a href="#cb7-8"></a>[img[images/priest1.jpg]]</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a>Der Priester bemerkt Emmy und droht ihr mit der Grabschaufel. Emmy weiß, daß sie</span>
<span id="cb7-11"><a href="#cb7-11"></a>unbewaffnet keine Chance gegen den Irren hat und flieht weiter nach</span>
<span id="cb7-12"><a href="#cb7-12"></a>[[Osten zum Brunnen-&gt;Brunnen]].</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In dieser Passage erkennt man, daß innerhalb von <code>&lt;&lt;if … else&gt;&gt;</code>-Makros nicht nur unterschiedliche Texte stehen, sondern auch jeweils verschiedene Bilder gezeigt werden können. In diesem Fall wird, wenn die <code>&lt;&lt;if&gt;&gt;</code>-Bedinung erfüllt ist, das Bild <em>angriff1.jpg</em> angezeigt, wenn nicht das Bild <em>priest1.jpg</em>. Außerdem wird – je nachdem ob die Bedinung erfüllt ist – die Hexe zu unterschiedlichen Passagen geführt (im Angriffsfall zu <code>Key</code> und im Fluchtfall zu <code>Brunnen</code>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1"><a href="#cb8-1"></a>:: Key {"position":"250,25","size":"100,100"}</span>
<span id="cb8-2"><a href="#cb8-2"></a>[img[images/dead7.jpg]]</span>
<span id="cb8-3"><a href="#cb8-3"></a>&lt;&lt;set $hasAttacked to true&gt;&gt;\</span>
<span id="cb8-4"><a href="#cb8-4"></a>&lt;&lt;set $hasKey to true&gt;&gt;\</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a>Sterbend bricht der Priester zusammen. Emmy nimmt dem kleinen Schlüssel an sich,</span>
<span id="cb8-7"><a href="#cb8-7"></a>den er am Gürtel trug.</span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a>Nun hat sie die Wahl. Sie kann zurück zum [[Brunnen]] oder sie kann dem</span>
<span id="cb8-10"><a href="#cb8-10"></a>schmalen [[Pfad]] nach Süden folgen.</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Die Passage <code>Key</code> kann nur einmal (nach dem Kampf) betreten werden (wenn nicht, habe ich etwas falsch gemacht). Sie hat auch nur den Zweck, die Variablen <code>$hasAttacked</code> und <code>$hasKey</code> auf <code>true</code> zu setzen.</p>
<p>Ausgestattet mit diesem Schlüssel gibt nun die (weit entfernte) Passage <code>Pförtnerhaus</code> auch den Weg zu dem Vorraum mit dem Schalter zur Toröffnung frei:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb9-1"><a href="#cb9-1"></a>:: Pförtnerhaus {"position":"800,500","size":"100,100"}</span>
<span id="cb9-2"><a href="#cb9-2"></a>[img[images/house6.jpg]]</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a>Emmy steht vor dem ziemlich heruntergekommenen Pförtnerhaus. Die Tür zum Haus ist</span>
<span id="cb9-5"><a href="#cb9-5"></a>verschlossen. Links davon steht ein verfallener Schuppen auf Stelzen. In dem</span>
<span id="cb9-6"><a href="#cb9-6"></a>Gerümpel daneben liegt eine alte, rostige Gießkanne.</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>[[Nördlich-&gt;Tor]] erkennt Emmy die Eingangspforte zum Friedhof. Sie kann aber</span>
<span id="cb9-9"><a href="#cb9-9"></a>auch einen [[Weg nach Westen-&gt;Vorplatz]] gehen.</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a>&lt;&lt;if $hasKey&gt;&gt;\</span>
<span id="cb9-12"><a href="#cb9-12"></a>Sie nimmt den Schlüssel, den sie dem toten Priester abgenommen hat, und öffnet</span>
<span id="cb9-13"><a href="#cb9-13"></a>die Tür. Sie betritt den [[Vorraum]] des Pförtnerhauses, der in einem rötlichen</span>
<span id="cb9-14"><a href="#cb9-14"></a>Licht schimmert.&lt;&lt;/if&gt;&gt;</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Hier schließt sich der Kreis: Wenn Emmy den Vorraum (und damit auch das Pförtnerhaus) wieder verläßt, ist das Friedhofstor (Passage <code>Tor</code>) offen und sie kann den Friedhof verlassen (Passage <code>MissionAccomplished</code>):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource twee number-lines code-with-copy"><code class="sourceCode"><span id="cb10-1"><a href="#cb10-1"></a>:: Tor {"position":"800,325","size":"100,100"}</span>
<span id="cb10-2"><a href="#cb10-2"></a>&lt;&lt;if $gateOpen&gt;&gt;\</span>
<span id="cb10-3"><a href="#cb10-3"></a>[img[images/gate_open2.jpg]]</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a>Das Tor ist offen, der Weg ist [[frei-&gt;MissionAccomplished]]!</span>
<span id="cb10-6"><a href="#cb10-6"></a>&lt;&lt;else&gt;&gt;\</span>
<span id="cb10-7"><a href="#cb10-7"></a>[img[images/gate_closed2.jpg]]</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>Das Eingangstor des Friedhofs ist fest verschlossen und es besitzt weder eine</span>
<span id="cb10-10"><a href="#cb10-10"></a>Klinke noch ein Schloß. Irgendwo muß es jedoch einen versteckten Mechanismus</span>
<span id="cb10-11"><a href="#cb10-11"></a>geben, mit dem das Tor aus der Ferne geöffnet werden kann.</span>
<span id="cb10-12"><a href="#cb10-12"></a>&lt;&lt;/if&gt;&gt;\</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a>Im [[Norden-&gt;Urnengräber]] ist eine Statue im Mondlicht zu erkennen, im</span>
<span id="cb10-15"><a href="#cb10-15"></a>[[Süden-&gt;Pförtnerhaus]] liegt die Ruine des alten Pförtnerhauses und nach</span>
<span id="cb10-16"><a href="#cb10-16"></a>[[Westen-&gt;Vorplatz]] führt ein Weg zurück zum Vorplatz an der Krypta.</span>
<span id="cb10-17"><a href="#cb10-17"></a></span>
<span id="cb10-18"><a href="#cb10-18"></a>:: MissionAccomplished {"position":"950,325","size":"100,100"}</span>
<span id="cb10-19"><a href="#cb10-19"></a>[img[images/missionacc8.jpg]]</span>
<span id="cb10-20"><a href="#cb10-20"></a></span>
<span id="cb10-21"><a href="#cb10-21"></a>Mission erfüllt. Fröhlich schwingt sich Emmy auf ihren Hexenbesen und fliegt</span>
<span id="cb10-22"><a href="#cb10-22"></a>auf den Brocken zum Hexentanzplatz, begleitet von einigen jubelnden Kürbissen.</span>
<span id="cb10-23"><a href="#cb10-23"></a></span>
<span id="cb10-24"><a href="#cb10-24"></a>!!!Ende</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Auch in der Passage <code>Tor</code> gibt es je nach Bedingung, ob <code>&lt;&lt;if $gateOpen&gt;&gt;</code> oder nicht, entweder ein Bild des geschlossenen Tores oder ein Bild eines (halb-) offenen Tores – jeweils mit entsprechendem Begleittext.</p>
<p>Zum Ende des Spiels gibt es noch eine kleine Ungereimtheit. Die Hexe kann durchaus die Passage <code>Gräberfeld2</code> wieder verlassen, ohne den Besen mitzunehmen. Das wird aber bisher noch nicht wieder abgefragt, die kleine Hexe kann sich also auf einen Besen schwingen, den sie noch gar nicht besitzt. Hier habe ich eine Korrektur in der nächsten Version vorgesehen. Ich wollte erst einmal eine durchspielbare Version schaffen, die ich auf Herz und Nieren durchtesten kann.</p>
<p><a href="https://kantel.github.io/posts/2023103102_halloween_twine/">Wie hier schon erwähnt</a>, habe ich alle Bilder für das Spiel mit dem <a href="http://cognitiones.kantel-chaos-team.de/technikgeschichte/rechnerundnetze/stablediffusion.html">Stable Diffusion</a>-Ableger <a href="https://clipdrop.co/stable-diffusion">Clipdrop</a> von <em>Stability.ai</em> mit dem Modell SDXL 1.0 und dem Stil <em>Comic Book</em> erzeugt und in <a href="https://www.flickr.com/photos/schockwellenreiter/albums/72177720312336247">diesem Flickr-Album</a> abgelegt. Ich habe hunderte von Bildern erzeugt, von denen ich 75 Bilder aufgehoben habe, und von denen bisher zwanzig (inklusive Cover) Verwendung fanden. Die Prompts zu den jeweiligen »Zeichnungen« findet Ihr in den Bildbschreibungen auf Flickr.</p>
<p>Auch wenn das nach viel Aufwand klingt, es hat sich meiner Meinung nach gelohnt. Die ausgesuchten Bilder passen vom Stil her gut in die Geschichte. Wenn man sich darauf einläßt und ein wenig mit den Prompts spielt, ist die Bildgenerierung mit Hilfe der gekünstelten Intelligenzia eine echte Alternative für jene wie mich, denen eine zeichnerische Begabung nicht in die Wiege gelegt wurde.</p>
<p>Den <a href="https://github.com/kantel/twine-entdecken/tree/master/Twine/halloween">Quellcode</a> habe ich mit den verwendeten <a href="https://github.com/kantel/twine-entdecken/tree/master/Twine/halloween/images">Bildern</a> sowohl als HTML- wie auch als <a href="https://github.com/kantel/twine-entdecken/tree/master/Twine/halloween/src">.twee-Datei</a> in meinem GitHub-Repositorium abgelegt. Und damit Ihr das auch testen könnt (das ist ja der Sinn einer frühen Version) gibt es das auch als <a href="https://kantel.itch.io/smashing-pumpkins">spielbare Fassung</a> auf Itch.io. (Auch wenn SugarCube nicht wirklich ein responsives Storyformat ist, funzt es in der derzeitigen Fassung sogar auf meinem Android-Handy (auch im Hochformat). Allerdings muß man am Ende des Spiels das Mobilphone aus- und wieder einschalten, sonst hängt man fest. Das werde ich in der endgültigen Fassung noch mit dem Einbau eines externen Links zurück zu Itch.io ändern.)</p>
<p><strong>Was kommt noch?</strong> Vorgesehen habe ich ein <em>bad ending</em>, in dem die Hexe den Kampf gegen den Priester auch verlieren kann. Die Überlebenschancen eröhen sich mit der Einnahme des Zaubertranks, dessen Flasche bisher noch sinnlos am Brunnen herumliegt. Und dann will ich noch eine Inventarliste anzeigen lassen (das ist zwar bei dem Mini-Inventar, das die Hexe mit sich herumschleppt, etwas <em>overkill</em>, aber da SugarCube das bietet und das Storyformat das Zeug dazu hat, auch aufwendigere Abenteuer zu entwickeln, möchte ich Euch zeigen, wie man so etwas realisiert). Daher: <em>Still digging!</em></p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="kantel/kantel.github.io" data-repo-id="R_kgDOIjiXMQ" data-category="General" data-category-id="DIC_kwDOIjiXMc4CS_hh" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>